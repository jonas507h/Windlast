<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Windlast Â· UI</title>
  <style>
    html, body { height: 100%; }
    body {
      margin: 0;
      display: grid;
      grid-template-rows: 80px 1fr 1fr;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .slot { min-height: 0; }
    .slot > iframe { width:100%; height:100%; border:0; display:block; }
  </style>
  <link rel="stylesheet" href="static/css/style.css">
  <script src="static/js/theme.js"></script>
</head>
<body>
  <div class="slot">
    <iframe src="partials/header.html" title="Header" data-theme-sync></iframe>
  </div>
  <div class="slot">
    <iframe src="partials/konstruktionen/wrapper.html" title="Konstruktionen" data-theme-sync></iframe>
  </div>
  <div class="slot">
    <iframe src="partials/footer.html" title="Ergebnisse" data-theme-sync></iframe>
  </div>
  <script>
    // Map API-Normkeys -> Footer-ID-Suffix
    const NORM_ID = {
      "EN_13814_2005": "en13814_2005",
      "EN_17879_2024": "en17879_2024",
      "EN_1991_1_4_2010": "en1991_2010",
    };

    function forwardResultsToFooter(payload) {
      const footer = document.querySelector('iframe[src*="partials/footer.html"]');
      footer?.contentWindow?.postMessage({ type: "results/update", payload }, "*");
    }

    window.addEventListener("message", (ev) => {
      const msg = ev.data;
      if (!msg || typeof msg !== "object") return;

      if (msg.type === "results" && msg.source === "tor") {
        forwardResultsToFooter(msg.payload);
      }
      if (msg.type === "toast") {
        console[msg.payload?.level === "error" ? "error" : "log"](msg.payload?.text);
      }
    });
  </script>
</body>
</html>
