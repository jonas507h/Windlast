<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Footer · Ergebnisse</title>
  <link rel="stylesheet" href="../static/css/style.css">
  <script src="../static/js/theme.js"></script>
</head>
<body class="wrap">
  <section class="panel">
    <h2 style="margin:0 0 10px;">Ergebnisse</h2>

    <table class="results-table" aria-describedby="results-caption">
      <caption id="results-caption" style="text-align:left; margin-bottom:6px;">
        Staudrücke / Sicherheiten (Platzhalter)
      </caption>
      <thead>
        <tr>
          <th scope="col" class="rowhead-stub">Nachweis</th>
          <th>DIN EN 13814:2005-06</th>
          <th data-tt="test">DIN EN 17879:2024-08</th>
          <th>DIN EN 1991-1-4:2010-12</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th scope="row" class="rowhead">Kippsicherheit</th>
          <td class="value" id="kipp_en13814_2005">–</td>
          <td class="value" id="kipp_en17879_2024">–</td>
          <td class="value" id="kipp_en1991_2010">–</td>
        </tr>
        <tr>
          <th scope="row" class="rowhead">Gleitsicherheit</th>
          <td class="value" id="gleit_en13814_2005">–</td>
          <td class="value" id="gleit_en17879_2024">–</td>
          <td class="value" id="gleit_en1991_2010">–</td>
        </tr>
        <tr>
          <th scope="row" class="rowhead">Abhebesicherheit</th>
          <td class="value" id="abhebe_en13814_2005">–</td>
          <td class="value" id="abhebe_en17879_2024">–</td>
          <td class="value" id="abhebe_en1991_2010">–</td>
        </tr>
        <tr>
          <th scope="row" class="rowhead">erforderlicher Ballast</th>
          <td class="value" id="ballast_en13814_2005">–</td>
          <td class="value" id="ballast_en17879_2024">–</td>
          <td class="value" id="ballast_en1991_2010">–</td>
        </tr>
      </tbody>
    </table>
  </section>
  <script src="/static/js/footer.js"></script>
  <style>
    /* Minimaler Tooltip */
    #tt-root {
      position: fixed;
      z-index: 9999;
      pointer-events: none;
      max-width: 36ch;
      background: #111;       /* dunkel, damit man’s sieht – später per Theme-Variablen */
      color: #fff;
      border-radius: 8px;
      padding: 8px 10px;
      font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      opacity: 0;
      transform: translate(-9999px,-9999px);
      transition: opacity .12s ease;
    }
    #tt-root.tt-visible { opacity: 1; }
  </style>

  <script>
    (function () {
      console.log("[tt] init");
      const OFFSET_X = 14, OFFSET_Y = 12, MARGIN = 4;
      let ttActive = false;

      function ensureRoot() {
        let el = document.getElementById('tt-root');
        if (!el) {
          console.log("[tt] creating root");
          el = document.createElement('div');
          el.id = 'tt-root';
          el.textContent = 'Test';
          el.style.position = 'fixed';                   // Cursor-Koordinaten
          el.style.left = '-9999px';                     // initial offscreen
          el.style.top = '-9999px';
          el.style.zIndex = '2147483647';                // ganz nach oben
          el.style.pointerEvents = 'none';
          el.style.background = '#111';
          el.style.color = '#fff';
          el.style.padding = '6px 10px';
          el.style.borderRadius = '8px';
          el.style.font = '14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif';
          el.style.boxShadow = '0 8px 24px rgba(0,0,0,.25)';
          el.style.opacity = '0';
          el.style.transition = 'opacity .08s ease';
          el.style.willChange = 'left, top, opacity';
          // Debug-Hilfe: Rahmen, bis es sitzt
          el.style.outline = '2px solid fuchsia';
          document.body.appendChild(el);
        }
        return el;
      }

      function updateAt(x, y) {
        const root = ensureRoot();
        console.log("[tt] updateAt", x, y);

        // kurz offscreen, dann Größe messen
        root.style.left = '-9999px';
        root.style.top  = '-9999px';
        const tt = root.getBoundingClientRect();

        const vw = document.documentElement.clientWidth;
        const vh = document.documentElement.clientHeight;

        const OFFSET_X = 14;
        const OFFSET_Y = 12;
        const MARGIN   = 4;

        // Standard: rechts/unten
        let left = x + OFFSET_X;
        let top  = y + OFFSET_Y;

        // Flippen, falls nicht genug Platz
        if (left + tt.width + MARGIN > vw)  left = x - OFFSET_X - tt.width;
        if (top  + tt.height + MARGIN > vh) top  = y - OFFSET_Y - tt.height;

        // Clampen
        left = Math.min(Math.max(MARGIN, left), vw - tt.width  - MARGIN);
        top  = Math.min(Math.max(MARGIN, top ), vh - tt.height - MARGIN);

        root.style.left = `${Math.round(left)}px`;
        root.style.top  = `${Math.round(top)}px`;
        root.style.opacity = '1';
      }

      function hide() {
        console.log("[tt] hide");
        const root = ensureRoot();
        root.style.opacity = '0';
        root.style.transform = 'translate(-9999px,-9999px)';
      }

      document.addEventListener('mouseover', (ev) => {
        console.log("[tt] mouseover", ev.target);
        if (!(ev.target instanceof Element)) return;
        const el = ev.target.closest('[data-tt]');
        if (!el) return;
        console.log("[tt] found data-tt element", el);
        ttActive = true;
        updateAt(ev.clientX, ev.clientY);
      }, true);

      document.addEventListener('mousemove', (ev) => {
        if (!ttActive) return;
        console.log("[tt] mousemove", ev.clientX, ev.clientY);
        updateAt(ev.clientX, ev.clientY);
      }, true);

      document.addEventListener('mouseout', (ev) => {
        console.log("[tt] mouseout", ev.target);
        if (!(ev.target instanceof Element)) return;
        if (ev.target.closest('[data-tt]')) {
          ttActive = false;
          hide();
        }
      }, true);

      document.addEventListener('focusin', (ev) => {
        console.log("[tt] focusin", ev.target);
      });
      document.addEventListener('focusout', (ev) => {
        console.log("[tt] focusout", ev.target);
        hide();
      });
    })();
  </script>
</body>
</html>
